import{f as m,a as d}from"../chunks/BUlJwuR3.js";import"../chunks/BTdNyzyd.js";import{o as de}from"../chunks/DgeWcLTZ.js";import{ar as fe,z as L,as as me,h as pe,b as y,at as _e,au as ue,a0 as be,av as he,aw as xe,a1 as ye,a9 as c,p as e,D as z,a4 as l,a5 as f,a6 as n,a7 as S,a8 as X}from"../chunks/DnZ8aS1A.js";import{e as B,s as k}from"../chunks/0SPjzxuk.js";import{e as F}from"../chunks/DYUyerag.js";import{i as R}from"../chunks/BtGiakpZ.js";import{r as ge,s as we}from"../chunks/CgoA2sbm.js";import{s as ze}from"../chunks/B1NNja7f.js";import{i as ke}from"../chunks/CBqTb_35.js";function $e(t,g,$=g){var C=new WeakSet;fe(t,"input",async w=>{var p=w?t.defaultValue:t.value;if(p=Y(t)?G(p):p,$(p),L!==null&&C.add(L),await me(),p!==(p=g())){var j=t.selectionStart,o=t.selectionEnd,D=t.value.length;if(t.value=p??"",o!==null){var h=t.value.length;j===o&&o===D&&h>D?(t.selectionStart=h,t.selectionEnd=h):(t.selectionStart=j,t.selectionEnd=Math.min(o,h))}}}),(pe&&t.defaultValue!==t.value||y(g)==null&&t.value)&&($(Y(t)?G(t.value):t.value),L!==null&&C.add(L)),_e(()=>{var w=g();if(t===document.activeElement){var p=ue??L;if(C.has(p))return}Y(t)&&w===G(t.value)||t.type==="date"&&!w&&!t.value||w!==t.value&&(t.value=w??"")})}function Y(t){var g=t.type;return g==="number"||g==="range"}function G(t){return t===""?null:+t}var je=m('<div class="text-red-400 text-sm"> </div>'),Ee=m('<span class="px-1.5 py-0.5 rounded bg-zinc-800/70"> </span>'),Se=m('<span class="opacity-60">No keywords</span>'),Ce=m('<button><div class="flex items-center gap-2"><span class="font-medium"> </span> <span class="text-xs px-2 py-0.5 rounded bg-zinc-800"> </span></div> <div class="mt-2 flex flex-wrap gap-1 text-xs opacity-80"><!> <!></div></button>'),De=m('<button class="text-left border border-zinc-700/60 rounded p-2 hover:bg-zinc-900/40"> </button>'),Me=m('<div class="opacity-60 text-sm"> </div>'),Ne=m('<div class="flex items-center justify-between"><h2 class="text-xl font-semibold"> </h2> <input class="px-3 py-1.5 rounded border border-zinc-700 bg-zinc-900 w-64" placeholder="Filter docs…"/></div> <div class="grid gap-2 svelte-5q4dpl"><!> <!></div>',1),Re=m('<div class="opacity-60">Choose a topic on the left.</div>'),Ae=m('<div class="opacity-60">Loading…</div>'),Ie=m('<pre class="whitespace-pre-wrap text-sm border border-zinc-700/60 rounded p-3"> </pre>'),Le=m('<h3 class="mt-4 text-lg font-semibold">Summary</h3> <!>',1),Oe=m('<div class="grid grid-cols-12 gap-6 p-8 min-h-screen svelte-5q4dpl"><aside class="col-span-4 space-y-4 sticky top-0 self-start"><div class="flex items-center justify-between"><h2 class="text-xl font-semibold">Topics</h2> <button class="px-3 py-1 rounded bg-zinc-800 hover:bg-zinc-700">Reload</button></div> <!> <!></aside> <main class="col-span-8 space-y-4"><!> <!></main></div>');function He(t,g){be(g,!1);const $=z(),C="/api",w="/Users/andrewcaulder/MannaWorker/var/summaries";let p={},j=z([]),o=z(null),D=z(null),h=z(""),P=z(!1),O=z(""),M=z("");const Z=a=>a.split("/").pop()??a,ee=a=>Z(a).replace(/\.json$/,""),ae=a=>(a??[]).slice(0,8);async function H(){c(O,"");try{const a=await fetch(`${C}/topics`);if(!a.ok)throw new Error(`topics ${a.status}`);const r=await a.json();p=Object.fromEntries(Object.entries(r).map(([s,i])=>[Number(s),i])),c(j,Object.entries(r).map(([s,i])=>({id:Number(s),...i})).sort((s,i)=>i.size-s.size)),!e(o)&&e(j).length&&c(o,e(j)[0])}catch(a){console.error(a),c(O,a?.message??"load failed")}}de(H);async function te(a){c(P,!0),c(h,""),c(D,a);try{const r=a.split("/").pop()?.replace(/\.json$/,"")??"",s=`${w}/${r}.md`,i=await fetch(`${C}/files?path=${encodeURIComponent(s)}`);c(h,i.ok?await i.text():"_summary not found_")}catch(r){console.error(r),c(h,"_summary not found_")}finally{c(P,!1)}}he(()=>(e(o),e(M)),()=>{c($,e(o)?e(o).docs.filter(a=>a.toLowerCase().includes(e(M).toLowerCase())):[])}),xe(),ke();var T=Oe(),V=l(T),W=l(V),re=f(l(W),2);n(W);var J=f(W,2);{var se=a=>{var r=je(),s=l(r,!0);n(r),S(()=>k(s,e(O))),d(a,r)};R(J,a=>{e(O)&&a(se)})}var oe=f(J,2);F(oe,1,()=>e(j),a=>a.id,(a,r)=>{var s=Ce(),i=l(s),E=l(i),_=l(E);n(E);var u=f(E,2),N=l(u);n(u),n(i);var U=f(i,2),q=l(U);F(q,1,()=>(e(r),y(()=>ae(e(r).keywords))),v=>v,(v,A)=>{var I=Ee(),ve=l(I,!0);n(I),S(()=>k(ve,e(A))),d(v,I)});var b=f(q,2);{var x=v=>{var A=Se();d(v,A)};R(b,v=>{e(r),y(()=>!e(r).keywords?.length)&&v(x)})}n(U),n(s),S(()=>{ze(s,1,`w-full text-left rounded border border-zinc-700/60 p-3 hover:bg-zinc-900/40 ${e(o),e(r),y(()=>e(o)?.id===e(r).id?"ring-2 ring-emerald-500/40 bg-zinc-900/60":"")??""}`),k(_,`#${e(r),y(()=>e(r).id)??""}`),k(N,`${e(r),y(()=>e(r).size)??""} docs`)}),B("click",s,()=>{c(o,e(r)),c(D,null),c(h,""),c(M,"")}),d(a,s)}),n(V);var K=f(V,2),Q=l(K);{var ie=a=>{var r=Ne(),s=X(r),i=l(s),E=l(i);n(i);var _=f(i,2);ge(_),n(s);var u=f(s,2),N=l(u);F(N,1,()=>e($),b=>b,(b,x)=>{var v=De(),A=l(v,!0);n(v),S(I=>{we(v,"title",e(x)),k(A,I)},[()=>(e(x),y(()=>ee(e(x))))]),B("click",v,()=>te(e(x))),d(b,v)});var U=f(N,2);{var q=b=>{var x=Me(),v=l(x);n(x),S(()=>k(v,`No docs match “${e(M)??""}”.`)),d(b,x)};R(U,b=>{e(o),e($),y(()=>e(o).docs.length&&!e($).length)&&b(q)})}n(u),S(()=>k(E,`Cluster #${e(o),y(()=>e(o).id)??""} · ${e(o),y(()=>e(o).size)??""} docs`)),$e(_,()=>e(M),b=>c(M,b)),d(a,r)},le=a=>{var r=Re();d(a,r)};R(Q,a=>{e(o)?a(ie):a(le,!1)})}var ne=f(Q,2);{var ce=a=>{var r=Le(),s=f(X(r),2);{var i=_=>{var u=Ae();d(_,u)},E=_=>{var u=Ie(),N=l(u,!0);n(u),S(()=>k(N,e(h))),d(_,u)};R(s,_=>{e(P)?_(i):_(E,!1)})}d(a,r)};R(ne,a=>{e(D)&&a(ce)})}n(K),n(T),B("click",re,H),d(t,T),ye()}export{He as component};
